<!DOCTYPE html>
<html lang="nl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fog of War - Multiplayer</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Inline styles hier zijn alleen voor referentie, ze moeten in style.css -->
  <style>
    /* Inline CSS hier is NIET AANBEVOLEN - Zet dit in style.css */
    /* Noodzakelijk voor de demo als style.css niet beschikbaar is */
    /* Zie het style.css blok hieronder voor de volledige CSS */
  </style>
</head>

<body>
  <!-- Main Title Banner -->
  <div class="main-title-banner">
    <h1>Fog of War</h1> <!-- Updated Title -->
  </div>

  <!-- Game Stats Bar -->
  <div class="game-stats-bar">
    <div class="stats-content">
      <div class="stat-item">
        <span class="stat-value" id="stats-phase">WAITING</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Player:</span>
        <span class="stat-value" id="stats-player">-</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Cycle:</span>
        <span class="stat-value" id="stats-cycle">-</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Round:</span>
        <span class="stat-value" id="stats-round">-</span>
      </div>
    </div>
  </div>

  <!-- Lobby Screens -->
  <div id="lobby-screen" class="screen">
    <!-- Removed original h1 here -->
    <div class="lobby-container">
      <div class="lobby-section">
        <h2>Create a Game</h2>
        <div class="form-group">
          <label for="create-name">Your Name:</label>
          <input type="text" id="create-name" placeholder="Enter your name" />
        </div>
        <button id="create-game-btn" class="primary-btn">Create Game</button>
      </div>
      <div class="lobby-divider"></div>
      <div class="lobby-section">
        <h2>Join a Game</h2>
        <div class="form-group">
          <label for="join-name">Your Name:</label>
          <input type="text" id="join-name" placeholder="Enter your name" />
        </div>
        <div class="form-group">
          <label for="room-code">Room Code:</label>
          <input type="text" id="room-code" placeholder="Enter 6-letter code" />
        </div>
        <button id="join-game-btn" class="primary-btn">Join Game</button>
      </div>
    </div>
    
  </div>

  <div id="waiting-screen" class="screen">
    <h1>Waiting for Opponent</h1>
    <div class="waiting-container">
      <div class="room-info">
        <h2>
          Room Code:
          <span id="display-room-code" class="highlighted-code">------</span>
          <span class="copy-icon" title="Copy Room Code"
            onclick="copyRoomCodeToClipboard('display-room-code')">📋</span>
        </h2>
        <p>Share this code with your opponent</p>
      </div>
      <div class="spinner"></div>
      <p id="waiting-message">Waiting for Player 2...</p>
    </div>
  </div>

  <div id="game-lobby-screen" class="screen">
    <h1>Game Lobby</h1>
    <div class="game-lobby-container">
      <div class="players-info">
        <div class="player-card" id="player1-card">
          <h3>Player 1</h3>
          <p id="player1-name">P1 Name</p>
          <div class="ready-status" id="player1-ready">Not Ready</div>
        </div>
        <div class="vs-label">VS</div>
        <div class="player-card" id="player2-card">
          <h3>Player 2</h3>
          <p id="player2-name">P2 Name</p>
          <div class="ready-status" id="player2-ready">Not Ready</div>
        </div>
      </div>
      <div class="room-details">
        <h3>
          Room Code:
          <span id="lobby-room-code" class="highlighted-code">------</span>
          <span class="copy-icon" title="Copy Room Code" onclick="copyRoomCodeToClipboard('lobby-room-code')">📋</span>
        </h3>
      </div>
      <div class="lobby-actions">
        <button id="ready-btn" class="primary-btn">I'm Ready</button>
        <p id="game-status-message">Both players must be ready</p>
      </div>
    </div>
  </div>
  <!-- Einde Lobby Screens -->

  <!-- Game Screen -->
  <div id="game-screen" class="screen">
    <div class="game-area">
      <!-- Left Column: Info + Chat + Medal -->
      <div id="left-column">
        <!-- Game Info Panel -->
        <div id="game-info-panel" class="ui-panel">
          <h3><span class="panel-icon">🗺️</span> Campaign Status</h3>

          <div id="player-info">
            <div id="player-indicator"></div>
            <span>You are General <span id="player-num">1</span> </span>
          </div>

          <hr>

          <!-- Pawn Count Display -->
          <div id="pawn-count-display">
            <h4>Regiment Count:</h4>
            <div class="pawn-count-row">
              <span class="player1-color">🔴 Player 1:</span> <span id="p1-pawn-count">0</span>
            </div>
            <div class="pawn-count-row">
              <span class="player2-color">🔵 Player 2:</span> <span id="p2-pawn-count">0</span>
            </div>
          </div>

          <hr>

          <!-- Volume Slider -->
          <div class="volume-control">
            <label for="volume-slider"><span class="panel-icon">🔉</span> Volume:</label>
            <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="0.5">
            <span id="volume-value">50%</span>
          </div>

          <button id="mute-btn" class="action-button secondary-button"><span class="btn-icon">🔊</span> Mute
            Signals</button>
        </div>

        <!-- Chat Panel -->
        <div id="chat-panel" class="ui-panel">
          <h3><span class="panel-icon">📜</span> War Council Chat</h3>
          <div id="chat-messages"></div>
          <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Issue Command..." />
            <button id="send-chat-btn" class="action-button"><span class="btn-icon">✉️</span> Send</button>
          </div>
        </div>

        <!-- Medal indicator -->
        <div id="medal-container">
          <img id="p1-medal" src="assets/images/p1_medal.png" alt="Player 1's Turn" />
          <img id="p2-medal" src="assets/images/p2_medal.png" alt="Player 2's Turn" style="display: none;" />
        </div>
      </div>

      <!-- Center: Board -->
      <div class="board-and-cards-area">
        <div id="board-background-wrapper">
          <div id="game-container">
            <!-- Haven Cells -->
            <div class="haven-cell player-1-haven" style="grid-area: 1 / 1;"></div>
            <div class="haven-cell player-1-haven" style="grid-area: 1 / 3;"></div>
            <div class="haven-cell player-1-haven" style="grid-area: 1 / 5;"></div>
            <div class="haven-cell player-1-haven" style="grid-area: 1 / 7;"></div>
            <div class="haven-cell player-1-haven" style="grid-area: 1 / 9;"></div>
            <div class="haven-cell player-2-haven" style="grid-area: 11 / 1;"></div>
            <div class="haven-cell player-2-haven" style="grid-area: 11 / 3;"></div>
            <div class="haven-cell player-2-haven" style="grid-area: 11 / 5;"></div>
            <div class="haven-cell player-2-haven" style="grid-area: 11 / 7;"></div>
            <div class="haven-cell player-2-haven" style="grid-area: 11 / 9;"></div>
            <!-- PixiJS Canvas comes here (within game-container) -->
          </div>
        </div>
      </div>

      <!-- Right Column: Cards -->
      <div id="card-ui-area" class="ui-panel">
          <div id="opponent-waiting" style="display: none">
            <h3><span class="panel-icon">⏳</span> Awaiting Opponent's Strategy</h3>
            <p>Hold position...</p>
            <div class="spinner small-spinner"></div>
          </div>
          <div id="card-definition-ui" style="display: none">
            <h3>
              <span class="panel-icon">✨</span> Devise Tactics - Round <span id="def-round-num">1</span> (P
              <span id="def-player-num">1</span>)
            </h3>
            <div id="card-presets">
              <h4>Standard Formations:</h4>
              <div class="preset-buttons-container">
                <button id="preset-speedy" class="preset-button">
                  Swift Scouts (1/5/1)
                </button>
                <button id="preset-attackers" class="preset-button">
                  Shock Troops (3/1/3)
                </button>
                <button id="preset-defenders" class="preset-button">
                  Iron Guard (4/1/2)
                </button>
              </div>
            </div>
            <p>Assign 7 points total (min 1 each) per unit.</p>
            <div class="card-input-grid">
              <div class="card-inputs">
                <h4>Unit 1</h4>
                <label>🛡️ Resilience (HP):
                  <input type="number" id="card1-hp" min="1" max="5" value="3" /></label>
                <label>🐎 March (Stamina):
                  <input type="number" id="card1-stamina" min="1" max="5" value="2" /></label>
                <label>⚔️ Might (Attack):
                  <input type="number" id="card1-attack" min="1" max="5" value="2" /></label>
                <span class="card-sum" id="card1-sum">Total: 7</span>
              </div>
              <div class="card-inputs">
                <h4>Unit 2</h4>
                <label>🛡️ Resilience (HP):
                  <input type="number" id="card2-hp" min="1" max="5" value="2" /></label>
                <label>🐎 March (Stamina):
                  <input type="number" id="card2-stamina" min="1" max="5" value="3" /></label>
                <label>⚔️ Might (Attack):
                  <input type="number" id="card2-attack" min="1" max="5" value="2" /></label>
                <span class="card-sum" id="card2-sum">Total: 7</span>
              </div>
              <div class="card-inputs">
                <h4>Unit 3</h4>
                <label>🛡️ Resilience (HP):
                  <input type="number" id="card3-hp" min="1" max="5" value="1" /></label>
                <label>🐎 March (Stamina):
                  <input type="number" id="card3-stamina" min="1" max="5" value="1" /></label>
                <label>⚔️ Might (Attack):
                  <input type="number" id="card3-attack" min="1" max="5" value="5" /></label>
                <span class="card-sum" id="card3-sum">Total: 7</span>
              </div>
            </div>
            <button id="confirm-cards-btn" class="action-button confirm-button"><span class="btn-icon">✔️</span>
              Finalize Orders</button>
          </div>
          <div id="card-reveal-ui" style="display: none">
            <h3><span class="panel-icon">👁️</span> Orders Revealed - Round <span id="reveal-round-num">1</span></h3>
            <div class="players-cards">
              <div class="player-cards-section">
                <h4>Your Orders:</h4>
                <div id="your-revealed-cards" class="revealed-cards">
                  <!-- Static Card Examples (will be replaced by JS) -->
                  <div class="card-item player-1">
                    <strong class="card-title">Unit 1</strong>
                    <div class="card-stats">
                      <span><span class="icon hp-icon">🛡️</span> <span class="value">3</span></span>
                      <span><span class="icon speed-icon">🐎</span> <span class="value">2</span></span>
                      <span><span class="icon attack-icon">⚔️</span> <span class="value">2</span></span>
                    </div>
                  </div>
                  <div class="card-item player-1">
                    <strong class="card-title">Unit 2</strong>
                    <div class="card-stats">
                      <span><span class="icon hp-icon">🛡️</span> <span class="value">2</span></span>
                      <span><span class="icon speed-icon">🐎</span> <span class="value">3</span></span>
                      <span><span class="icon attack-icon">⚔️</span> <span class="value">2</span></span>
                    </div>
                  </div>
                  <!-- End Static Examples -->
                </div>
              </div>
              <div class="player-cards-section">
                <h4>Opponent's Orders:</h4>
                <div id="opponent-revealed-cards" class="revealed-cards">
                  <!-- Static Card Examples (will be replaced by JS) -->
                  <div class="card-item player-2">
                    <strong class="card-title">Unit 1</strong>
                    <div class="card-stats">
                      <span><span class="icon hp-icon">🛡️</span> <span class="value">4</span></span>
                      <span><span class="icon speed-icon">🐎</span> <span class="value">1</span></span>
                      <span><span class="icon attack-icon">⚔️</span> <span class="value">2</span></span>
                    </div>
                  </div>
                  <div class="card-item player-2">
                    <strong class="card-title">Unit 2</strong>
                    <div class="card-stats">
                      <span><span class="icon hp-icon">🛡️</span> <span class="value">1</span></span>
                      <span><span class="icon speed-icon">🐎</span> <span class="value">5</span></span>
                      <span><span class="icon attack-icon">⚔️</span> <span class="value">1</span></span>
                    </div>
                  </div>
                  <!-- End Static Examples -->
                </div>
              </div>
            </div>
            <div id="initiative-result">
              <h4><span class="panel-icon">⭐</span> Initiative:</h4>
              <p>
                Player <span id="initiative-player">1</span> holds the initiative!
              </p>
              <p id="initiative-reason">(Superior Firepower: 9 vs 7)</p>
            </div>
          </div>
          <div id="linking-ui" style="display: none">
            <h3>
              <span class="panel-icon">🔗</span> Assign Units - Round <span id="link-round-num">1</span>, P
              <span id="link-player-num">1</span>
            </h3>
            <div id="available-cards-linking">
              <h4><span class="panel-icon">🃏</span> Available Units:</h4>
              <div class="card-list-container">
                <!-- Static Card Examples (will be replaced by JS) -->
                <div class="card-item player-2 linked">
                  <strong class="card-title">Opp Unit 1</strong>
                  <div class="card-stats">
                    <span><span class="icon hp-icon">🛡️</span> <span class="value">4</span></span>
                    <span><span class="icon speed-icon">🐎</span> <span class="value">1</span></span>
                    <span><span class="icon attack-icon">⚔️</span> <span class="value">2</span></span>
                  </div>
                  <div class="linked-overlay">ASSIGNED</div>
                </div>
                <div class="card-item player-1 card-selected">
                  <strong class="card-title">Your Unit 2</strong>
                  <div class="card-stats">
                    <span><span class="icon hp-icon">🛡️</span> <span class="value">2</span></span>
                    <span><span class="icon speed-icon">🐎</span> <span class="value">3</span></span>
                    <span><span class="icon attack-icon">⚔️</span> <span class="value">2</span></span>
                  </div>
                </div>
                <div class="card-item player-1">
                  <strong class="card-title">Your Unit 3</strong>
                  <div class="card-stats">
                    <span><span class="icon hp-icon">🛡️</span> <span class="value">1</span></span>
                    <span><span class="icon speed-icon">🐎</span> <span class="value">1</span></span>
                    <span><span class="icon attack-icon">⚔️</span> <span class="value">5</span></span>
                  </div>
                </div>
                <!-- End Static Examples -->
              </div>
            </div>
            <div id="linking-status">Select an unassigned unit, then select a regiment on the map.</div>
          </div>

          <!-- Timer Display -->
          <div id="phase-timer" class="ui-timer" style="display: none;">
            ⏳ Time left: <span id="phase-timer-count">20</span>s
          </div>

          <!-- RPS Tiebreaker UI -->
          <div id="rps-tiebreaker-ui" style="display: none;">
            <h3><span class="panel-icon">⚔️</span> Initiative Duel! <span class="panel-icon">⚔️</span></h3>
            <p>Equal tactics measured! Settle the initiative with swift action!</p>
            <p id="rps-instruction" style="font-weight: bold;">Choose your Maneuver!</p>
            <div id="rps-buttons">
              <button id="rps-rock" class="rps-choice-btn action-button" data-choice="rock"
                title="Steadfast Defense (Rock)">🪨</button>
              <button id="rps-paper" class="rps-choice-btn action-button" data-choice="paper"
                title="Enveloping Formation (Paper)">📜</button>
              <button id="rps-scissors" class="rps-choice-btn action-button" data-choice="scissors"
                title="Flanking Attack (Scissors)">✂️</button>
            </div>
            <div id="rps-result">
              <!-- Results will be filled here -->
            </div>
          </div>

          <!-- Action UI -->
          <div id="action-ui" style="display: none">
            <h3><span class="panel-icon">⚔️</span> Action Phase (P <span id="action-player-num">1</span>)</h3>
            <div id="selected-pawn-info">Select a regiment to command.</div>
          </div>

          <!-- Epic Victory Screen -->
          <div id="game-over" style="display: none;">
            <div class="victory-container">
              <div class="victory-crown">👑</div>
              <h2 class="victory-title">GLORIOUS VICTORY!</h2>
              <div class="victory-message">
                General <span id="winner-name">1</span> has conquered the battlefield!
              </div>
              <div class="victory-banner">
                <div class="victory-medal left"></div>
                <div class="victory-text">TRIUMPH</div>
                <div class="victory-medal right"></div>
              </div>
              <div class="victory-fireworks">
                <div class="firework" id="firework1"></div>
                <div class="firework" id="firework2"></div>
                <div class="firework" id="firework3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- End of game-area -->
  </div>

  <!-- Toast notification -->
  <div id="toast-notification" class="toast-hidden">
    <div id="toast-message">Notification message</div>
  </div>

  <!-- Pawn Tooltip Element -->
  <div id="pawn-tooltip" class="tooltip" style="display: none; position: absolute; z-index: 100;">
    <!-- Content will be set by JS -->
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
  <!-- <script src="/socket.io/socket.io.js"></script> -->
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"
    integrity="sha384-Gr6Lu2Ajx28mzwyVR8CFkULdCU7kMlZ9UthllibdOSo6qAiN+yXNHqtgdTvFXMT4"
    crossorigin="anonymous"></script>

  <!-- Prevent auto-connection -->
  <script>
    // Prevent Socket.IO from auto-connecting
    if (typeof io !== 'undefined') {
      io.defaults = { autoConnect: false };
    }
  </script>

  <!-- Game patch -->
  <script src="js/game-patch.js"></script>

  <!-- Game scripts -->
  <script src="js/game-constants.js"></script>
  <script src="js/game-classes.js"></script>
  <script src="js/physics-attack-v2.js"></script>
  <!-- Removed test/instructions panels in singleplayer build -->
  <script src="js/physics-attack-sync.js"></script>
  <script src="js/sound-manager.js"></script>
  <script src="js/loading-screen.js"></script>
  <script src="js/menu-system.js"></script>
  <script src="js/lobby.js"></script>
  <script src="js/game-ui.js"></script>
  <script src="js/game-logic.js"></script>
  <script src="js/card-flip-fix.js"></script>
  <script src="js/singleplayer-simple.js"></script>
  <script src="js/main.js"></script>

  <!-- Copy to Clipboard Functie -->
  <script>
    function copyRoomCodeToClipboard(elementId) {
      const codeElement = document.getElementById(elementId);
      if (!codeElement) {
        console.error(`Element with ID "${elementId}" not found.`);
        showToastMessage("Error finding room code.");
        return;
      }
      const roomCode = codeElement.textContent.trim();
      if (!roomCode || roomCode === "------") {
        console.warn("No valid room code.");
        showToastMessage("No room code yet.");
        return;
      }
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard
          .writeText(roomCode)
          .then(() => {
            console.log(`Copied: ${roomCode}`);
            showToastMessage(`Code "${roomCode}" copied!`);
          })
          .catch((err) => {
            console.error("Clipboard API failed:", err);
            showToastMessage("Copy failed. Trying fallback...");
            fallbackCopyText(roomCode);
          });
      } else {
        console.warn("Using fallback copy.");
        fallbackCopyText(roomCode);
      }
    }
    function fallbackCopyText(text) {
      const t = document.createElement("textarea");
      t.value = text;
      t.style.position = "fixed";
      t.style.opacity = "0";
      document.body.appendChild(t);
      t.focus();
      t.select();
      try {
        const s = document.execCommand("copy");
        showToastMessage(
          s ? `Code "${text}" copied (fallback).` : "Fallback copy failed."
        );
      } catch (err) {
        showToastMessage("Fallback copy error.");
      }
      document.body.removeChild(t);
    }
    function showToastMessage(message, duration = 2500) {
      const t = document.getElementById("toast-notification"),
        m = document.getElementById("toast-message");
      if (t && m) {
        if (
          typeof showToast === "function" &&
          showToast !== showToastMessage
        ) {
          showToast(message, duration);
        } else {
          m.textContent = message;
          t.classList.remove("toast-hidden");
          t.classList.add("toast-visible");
          setTimeout(() => {
            t.classList.remove("toast-visible");
            t.classList.add("toast-hidden");
          }, duration);
        }
      } else {
        alert(message);
      }
    }
  </script>
</body>

</html>