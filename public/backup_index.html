<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fog of War - Multiplayer</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Inline styles hier zijn alleen voor referentie, ze moeten in style.css -->
    <style>
      /* Inline CSS hier is NIET AANBEVOLEN - Zet dit in style.css */
      /* Noodzakelijk voor de demo als style.css niet beschikbaar is */
      /* Zie het style.css blok hieronder voor de volledige CSS */
    </style>
  </head>

  <body>
    <!-- Lobby Screens -->
    <div id="lobby-screen" class="screen active">
      <h1>Fog of War</h1>
      <div class="lobby-container">
        <div class="lobby-section">
          <h2>Create a Game</h2>
          <div class="form-group">
            <label for="create-name">Your Name:</label>
            <input type="text" id="create-name" placeholder="Enter your name" />
          </div>
          <button id="create-game-btn" class="primary-btn">Create Game</button>
        </div>
        <div class="lobby-divider"></div>
        <div class="lobby-section">
          <h2>Join a Game</h2>
          <div class="form-group">
            <label for="join-name">Your Name:</label>
            <input type="text" id="join-name" placeholder="Enter your name" />
          </div>
          <div class="form-group">
            <label for="room-code">Room Code:</label>
            <input
              type="text"
              id="room-code"
              placeholder="Enter 6-letter code"
            />
          </div>
          <button id="join-game-btn" class="primary-btn">Join Game</button>
        </div>
      </div>
    </div>

    <div id="waiting-screen" class="screen">
      <h1>Waiting for Opponent</h1>
      <div class="waiting-container">
        <div class="room-info">
          <h2>
            Room Code:
            <span id="display-room-code" class="highlighted-code">------</span>
            <span
              class="copy-icon"
              title="Copy Room Code"
              onclick="copyRoomCodeToClipboard('display-room-code')"
              >📋</span
            >
          </h2>
          <p>Share this code with your opponent</p>
        </div>
        <div class="spinner"></div>
        <p id="waiting-message">Waiting for Player 2...</p>
      </div>
    </div>

    <div id="game-lobby-screen" class="screen">
      <h1>Game Lobby</h1>
      <div class="game-lobby-container">
        <div class="players-info">
          <div class="player-card" id="player1-card">
            <h3>Player 1</h3>
            <p id="player1-name">P1 Name</p>
            <div class="ready-status" id="player1-ready">Not Ready</div>
          </div>
          <div class="vs-label">VS</div>
          <div class="player-card" id="player2-card">
            <h3>Player 2</h3>
            <p id="player2-name">P2 Name</p>
            <div class="ready-status" id="player2-ready">Not Ready</div>
          </div>
        </div>
        <div class="room-details">
          <h3>
            Room Code:
            <span id="lobby-room-code" class="highlighted-code">------</span>
            <span
              class="copy-icon"
              title="Copy Room Code"
              onclick="copyRoomCodeToClipboard('lobby-room-code')"
              >📋</span
            >
          </h3>
        </div>
        <div class="lobby-actions">
          <button id="ready-btn" class="primary-btn">I'm Ready</button>
          <p id="game-status-message">Both players must be ready</p>
        </div>
      </div>
    </div>
    <!-- Einde Lobby Screens -->

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
      <h1>Fog of War</h1>
      <div class="game-area">
        <!-- Kolom 1: Chat Panel -->
        <div id="chat-panel">
          <h3>Game Chat</h3>
          <div id="chat-messages"></div>
          <div class="chat-input-area">
            <input
              type="text"
              id="chat-input"
              placeholder="Type a message..."
            />
            <button id="send-chat-btn">Send</button>
          </div>
        </div>

        <!-- Kolom 2: Bord + Kaart UI eronder -->
        <div class="board-and-cards-area">
          <div id="game-container">
            <!-- PixiJS Canvas komt hier -->
          </div>
          <div id="card-ui-area">
            <div id="opponent-waiting" style="display: none">
              <h3>Waiting for Opponent</h3>
              <p>...</p>
              <div class="spinner small-spinner"></div>
            </div>
            <div id="card-definition-ui" style="display: none">
              <h3>
                Define Cards for Round <span id="def-round-num">1</span> (P
                <span id="def-player-num">1</span>)
              </h3>
              <div id="card-presets">
                <h4>Quick Presets:</h4>
                <div class="preset-buttons-container">
                  <button id="preset-speedy" class="preset-button">
                    Speedy 1/5/1
                  </button>
                  <button id="preset-attackers" class="preset-button">
                    Attackers 3/1/3
                  </button>
                  <button id="preset-defenders" class="preset-button">
                    Defenders 4/1/2
                  </button>
                </div>
              </div>
              <p>Stats must sum to 7 (min 1 each).</p>
              <div class="card-input-grid">
                <div class="card-inputs">
                  <h4>Card 1</h4>
                  <label
                    >HP:
                    <input
                      type="number"
                      id="card1-hp"
                      min="1"
                      max="5"
                      value="3"
                  /></label>
                  <label
                    >Speed:
                    <input
                      type="number"
                      id="card1-speed"
                      min="1"
                      max="5"
                      value="2"
                  /></label>
                  <label
                    >Attack:
                    <input
                      type="number"
                      id="card1-attack"
                      min="1"
                      max="5"
                      value="2"
                  /></label>
                  <span class="card-sum" id="card1-sum">Sum: 7</span>
                </div>
                <div class="card-inputs">
                  <h4>Card 2</h4>
                  <label
                    >HP:
                    <input
                      type="number"
                      id="card2-hp"
                      min="1"
                      max="5"
                      value="2"
                  /></label>
                  <label
                    >Speed:
                    <input
                      type="number"
                      id="card2-speed"
                      min="1"
                      max="5"
                      value="3"
                  /></label>
                  <label
                    >Attack:
                    <input
                      type="number"
                      id="card2-attack"
                      min="1"
                      max="5"
                      value="2"
                  /></label>
                  <span class="card-sum" id="card2-sum">Sum: 7</span>
                </div>
                <div class="card-inputs">
                  <h4>Card 3</h4>
                  <label
                    >HP:
                    <input
                      type="number"
                      id="card3-hp"
                      min="1"
                      max="5"
                      value="1"
                  /></label>
                  <label
                    >Speed:
                    <input
                      type="number"
                      id="card3-speed"
                      min="1"
                      max="5"
                      value="1"
                  /></label>
                  <label
                    >Attack:
                    <input
                      type="number"
                      id="card3-attack"
                      min="1"
                      max="5"
                      value="5"
                  /></label>
                  <span class="card-sum" id="card3-sum">Sum: 7</span>
                </div>
              </div>
              <button id="confirm-cards-btn">Confirm Cards</button>
            </div>
            <div id="card-reveal-ui" style="display: none">
              <h3>Card Reveal - Round <span id="reveal-round-num">1</span></h3>
              <div class="players-cards">
                <div class="player-cards-section">
                  <h4>Your Cards:</h4>
                  <div id="your-revealed-cards" class="revealed-cards"></div>
                </div>
                <div class="player-cards-section">
                  <h4>Opponent Cards:</h4>
                  <div
                    id="opponent-revealed-cards"
                    class="revealed-cards"
                  ></div>
                </div>
              </div>
              <div id="initiative-result">
                <h4>Initiative:</h4>
                <p>
                  Player <span id="initiative-player">1</span> has initiative
                </p>
                <p id="initiative-reason">(Reason)</p>
              </div>
            </div>
            <div id="linking-ui" style="display: none">
              <h3>
                Link Cards (Round <span id="link-round-num">1</span>, P
                <span id="link-player-num">1</span>)
              </h3>
              <div id="available-cards-linking">
                <h4>Available Cards:</h4>
                <div class="card-list-container"></div>
              </div>
              <div id="linking-status">Select a card, then select a pawn.</div>
            </div>

            <!-- VEREENVOUDIGDE RPS Tiebreaker UI -->
            <div
              id="rps-tiebreaker-ui"
              style="
                display: none;
                padding: 15px;
                border: 2px dashed #e0a800;
                background-color: #fffbeb;
                text-align: center;
              "
            >
              <h3>Initiative Tiebreaker!</h3>
              <p>Attack & Speed Tie! Play Rock Paper Scissors to start.</p>
              <!-- Instructie / Status -->
              <p
                id="rps-instruction"
                style="font-weight: bold; min-height: 20px; color: #333"
              >
                Choose your move!
              </p>
              <!-- Knoppen (blijven hetzelfde) -->
              <div
                id="rps-buttons"
                style="
                  margin: 15px 0;
                  display: flex;
                  justify-content: center;
                  gap: 15px;
                "
              >
                <button
                  id="rps-rock"
                  class="rps-choice-btn primary-btn"
                  data-choice="rock"
                  style="font-size: 1.2em; min-width: 70px"
                >
                  🪨
                </button>
                <button
                  id="rps-paper"
                  class="rps-choice-btn primary-btn"
                  data-choice="paper"
                  style="font-size: 1.2em; min-width: 70px"
                >
                  📄
                </button>
                <button
                  id="rps-scissors"
                  class="rps-choice-btn primary-btn"
                  data-choice="scissors"
                  style="font-size: 1.2em; min-width: 70px"
                >
                  ✂️
                </button>
              </div>
              <!-- Resultaat van de Ronde -->
              <div
                id="rps-result"
                style="
                  min-height: 40px;
                  margin-top: 10px;
                  font-style: italic;
                  font-weight: bold;
                "
              >
                <!-- Resultaten worden hier getoond -->
              </div>
            </div>
            <!-- EINDE VEREENVOUDIGDE RPS Tiebreaker UI -->
          </div>
        </div>

        <!-- Kolom 3: UI Sidebar (Game Info / Acties) -->
        <div id="ui-sidebar">
          <div id="game-info-panel">
            <h2>Game Info</h2>
            <div id="game-status">Phase: PRE_GAME, P: 1</div>
            <div id="room-info">
              Room: <span id="game-room-code">------</span>
              <span
                class="copy-icon"
                title="Copy Room Code"
                onclick="copyRoomCodeToClipboard('game-room-code')"
                >📋</span
              >
            </div>
            <div id="player-info">
              <div id="player-indicator"></div>
              <span>You are Player <span id="player-num">1</span></span>
            </div>
            <button id="mute-btn" style="margin-top: 10px; width: 100%">
              Mute Sounds
            </button>
          </div>
          <div id="action-ui" style="display: none">
            <h3>Action Phase (P <span id="action-player-num">1</span>)</h3>
            <div id="selected-pawn-info">Select a pawn to act.</div>
            <div id="action-buttons" style="display: none">
              <button id="move-btn">Move</button>
              <button id="attack-btn">Attack</button>
              <button id="cancel-action-btn">Cancel</button>
            </div>
          </div>
          <div
            id="game-over"
            style="color: red; font-weight: bold; display: none"
          ></div>
        </div>
      </div>
    </div>

    <!-- Toast notification -->
    <div id="toast-notification" class="toast-hidden">
      <div id="toast-message">Notification message</div>
    </div>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <!-- <script src="/socket.io/socket.io.js"></script> -->
    <script
      src="https://cdn.socket.io/4.7.4/socket.io.min.js"
      integrity="sha384-Gr6Lu2Ajx28mzwyVR8CFkULdCU7kMlZ9UthllibdOSo6qAiN+yXNHqtgdTvFXMT4"
      crossorigin="anonymous"
    ></script>

    <!-- Game patch -->
    <script src="js/game-patch.js"></script>

    <!-- Game scripts -->
    <script src="js/game-constants.js"></script>
    <script src="js/game-classes.js"></script>
    <script src="js/sound-manager.js"></script>
    <script src="js/lobby.js"></script>
    <script src="js/game-ui.js"></script>
    <script src="js/game-logic.js"></script>
    <script src="js/physics-attack.js"></script>
    <script src="js/card-flip-fix.js"></script>
    <script src="js/main.js"></script>

    <!-- Copy to Clipboard Functie -->
    <script>
      function copyRoomCodeToClipboard(elementId) {
        const codeElement = document.getElementById(elementId);
        if (!codeElement) {
          console.error(`Element with ID "${elementId}" not found.`);
          showToastMessage("Error finding room code.");
          return;
        }
        const roomCode = codeElement.textContent.trim();
        if (!roomCode || roomCode === "------") {
          console.warn("No valid room code.");
          showToastMessage("No room code yet.");
          return;
        }
        if (navigator.clipboard && window.isSecureContext) {
          navigator.clipboard
            .writeText(roomCode)
            .then(() => {
              console.log(`Copied: ${roomCode}`);
              showToastMessage(`Code "${roomCode}" copied!`);
            })
            .catch((err) => {
              console.error("Clipboard API failed:", err);
              showToastMessage("Copy failed. Trying fallback...");
              fallbackCopyText(roomCode);
            });
        } else {
          console.warn("Using fallback copy.");
          fallbackCopyText(roomCode);
        }
      }
      function fallbackCopyText(text) {
        const t = document.createElement("textarea");
        t.value = text;
        t.style.position = "fixed";
        t.style.opacity = "0";
        document.body.appendChild(t);
        t.focus();
        t.select();
        try {
          const s = document.execCommand("copy");
          showToastMessage(
            s ? `Code "${text}" copied (fallback).` : "Fallback copy failed."
          );
        } catch (err) {
          showToastMessage("Fallback copy error.");
        }
        document.body.removeChild(t);
      }
      function showToastMessage(message, duration = 2500) {
        const t = document.getElementById("toast-notification"),
          m = document.getElementById("toast-message");
        if (t && m) {
          if (
            typeof showToast === "function" &&
            showToast !== showToastMessage
          ) {
            showToast(message, duration);
          } else {
            m.textContent = message;
            t.classList.remove("toast-hidden");
            t.classList.add("toast-visible");
            setTimeout(() => {
              t.classList.remove("toast-visible");
              t.classList.add("toast-hidden");
            }, duration);
          }
        } else {
          alert(message);
        }
      }
    </script>
  </body>
</html>
